# Twitter
Twitterに関するもの

importzzzzsysabcdeimportzzzzcv2abcdeimportzzzznumpyzzzzaszzzznpabcdeimportzzzztensorflowzzzzaszzzztfabcdeimportzzzztensorflow.python.platformabcdeimportzzzzosabcdeimportzzzzglobabcdeimportzzzzscipyabcdefromzzzzscipyzzzzimportzzzzioabcdeimportzzzztimeabcdefromzzzztensorflow.contribzzzzimportzzzzlearnabcdeimportzzzzrandomabcdefromzzzzjoblibzzzzimportzzzzParallel,zzzzdelayedabcdeabcde###############################################################################abcde#zzzzConstantszzzzforzzzzthezzzzimagezzzzinputzzzzandzzzzoutput.abcde###############################################################################abcdeabcde#zzzzOutputzzzzfolderzzzzforzzzzthezzzzimages.abcdeOUTPUT_DIRzzzz=zzzz'output/'abcde#zzzzStylezzzzimagezzzztozzzzuse.abcdeSTYLE_IMAGEzzzz=zzzz'images/guernica.jpg'abcde#zzzzContentzzzzimagezzzztozzzzuse.abcdeCONTENT_IMAGEzzzz=zzzz'images/hongkong.jpg'abcde#zzzzImagezzzzdimensionszzzzconstants.zzzzabcdeIMAGE_WIDTHzzzz=zzzz288abcdeIMAGE_HEIGHTzzzz=zzzz288abcdeCOLOR_CHANNELSzzzz=zzzz3abcdeabcde###############################################################################abcde#zzzzAlgorithmzzzzconstantsabcde###############################################################################abcde#zzzzNoisezzzzratio.zzzzPercentagezzzzofzzzzweightzzzzofzzzzthezzzznoisezzzzforzzzzintermixingzzzzwithzzzztheabcde#zzzzcontentzzzzimage.abcdeNOISE_RATIOzzzz=zzzz0.6abcdeabcdeVGG_MODELzzzz=zzzz'imagenet-vgg-verydeep-19.mat'abcde#zzzzThezzzzmeanzzzztozzzzsubtractzzzzfromzzzzthezzzzinputzzzztozzzzthezzzzVGGzzzzmodel.zzzzThiszzzziszzzzthezzzzmeanzzzzthatabcde#zzzzwhenzzzzthezzzzVGGzzzzwaszzzzusedzzzztozzzztrain.zzzzMinorzzzzchangeszzzztozzzzthiszzzzwillzzzzmakezzzzazzzzlotzzzzofabcde#zzzzdifferencezzzztozzzzthezzzzperformancezzzzofzzzzmodel.abcdeMEAN_VALUESzzzz=zzzznp.array([123.68,zzzz116.779,zzzz103.939]).reshape((1,1,1,3))abcdeabcdedefzzzzload_vgg_model(path):abcdezzzzzzzzzzzzzzzz"""abcdezzzzzzzzzzzzzzzzReturnszzzzazzzzmodelzzzzforzzzzthezzzzpurposezzzzofzzzz'painting'zzzzthezzzzpicture.abcdezzzzzzzzzzzzzzzzTakeszzzzonlyzzzzthezzzzconvolutionzzzzlayerzzzzweightszzzzandzzzzwrapzzzzusingzzzzthezzzzTensorFlowabcdezzzzzzzzzzzzzzzzConv2d,zzzzReluzzzzandzzzzAveragePoolingzzzzlayer.zzzzVGGzzzzactuallyzzzzuseszzzzmaxpoolzzzzbutabcdezzzzzzzzzzzzzzzzthezzzzpaperzzzzindicateszzzzthatzzzzusingzzzzAveragePoolingzzzzyieldszzzzbetterzzzzresults.abcdezzzzzzzzzzzzzzzzThezzzzlastzzzzfewzzzzfullyzzzzconnectedzzzzlayerszzzzarezzzznotzzzzused.abcdezzzzzzzzzzzzzzzzHerezzzziszzzzthezzzzdetailedzzzzconfigurationzzzzofzzzzthezzzzVGGzzzzmodel:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz0zzzziszzzzconv1_1zzzz(3,zzzz3,zzzz3,zzzz64)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz1zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz2zzzziszzzzconv1_2zzzz(3,zzzz3,zzzz64,zzzz64)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz3zzzziszzzzreluzzzzzzzzzzzzzzzzabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz4zzzziszzzzmaxpoolabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz5zzzziszzzzconv2_1zzzz(3,zzzz3,zzzz64,zzzz128)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz6zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz7zzzziszzzzconv2_2zzzz(3,zzzz3,zzzz128,zzzz128)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz8zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz9zzzziszzzzmaxpoolabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz10zzzziszzzzconv3_1zzzz(3,zzzz3,zzzz128,zzzz256)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz11zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz12zzzziszzzzconv3_2zzzz(3,zzzz3,zzzz256,zzzz256)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz13zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz14zzzziszzzzconv3_3zzzz(3,zzzz3,zzzz256,zzzz256)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz15zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz16zzzziszzzzconv3_4zzzz(3,zzzz3,zzzz256,zzzz256)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz17zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz18zzzziszzzzmaxpoolabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz19zzzziszzzzconv4_1zzzz(3,zzzz3,zzzz256,zzzz512)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz20zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz21zzzziszzzzconv4_2zzzz(3,zzzz3,zzzz512,zzzz512)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz22zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz23zzzziszzzzconv4_3zzzz(3,zzzz3,zzzz512,zzzz512)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz24zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz25zzzziszzzzconv4_4zzzz(3,zzzz3,zzzz512,zzzz512)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz26zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz27zzzziszzzzmaxpoolabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz28zzzziszzzzconv5_1zzzz(3,zzzz3,zzzz512,zzzz512)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz29zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz30zzzziszzzzconv5_2zzzz(3,zzzz3,zzzz512,zzzz512)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz31zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz32zzzziszzzzconv5_3zzzz(3,zzzz3,zzzz512,zzzz512)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz33zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz34zzzziszzzzconv5_4zzzz(3,zzzz3,zzzz512,zzzz512)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz35zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz36zzzziszzzzmaxpoolabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz37zzzziszzzzfullyconnectedzzzz(7,zzzz7,zzzz512,zzzz4096)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz38zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz39zzzziszzzzfullyconnectedzzzz(1,zzzz1,zzzz4096,zzzz4096)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz40zzzziszzzzreluabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz41zzzziszzzzfullyconnectedzzzz(1,zzzz1,zzzz4096,zzzz1000)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz42zzzziszzzzsoftmaxabcdezzzzzzzzzzzzzzzz"""abcdezzzzzzzzzzzzzzzzvggzzzz=zzzzscipy.io.loadmat(path)abcdeabcdezzzzzzzzzzzzzzzzvgg_layerszzzz=zzzzvgg['layers']abcdezzzzzzzzzzzzzzzzdefzzzz_weights(layer,zzzzexpected_layer_name):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"""abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzReturnzzzzthezzzzweightszzzzandzzzzbiaszzzzfromzzzzthezzzzVGGzzzzmodelzzzzforzzzzazzzzgivenzzzzlayer.abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"""abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzprint(vgg_layers[0][layer][0][0][0])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzWzzzz=zzzzvgg_layers[0][layer][0][0][2][0][0]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzbzzzz=zzzzvgg_layers[0][layer][0][0][2][0][1]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzlayer_namezzzz=zzzzvgg_layers[0][layer][0][0][0]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzassertzzzzlayer_namezzzz==zzzzexpected_layer_nameabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzreturnzzzzW,zzzzbabcdeabcdezzzzzzzzzzzzzzzzdefzzzz_relu(conv2d_layer):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"""abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzReturnzzzzthezzzzRELUzzzzfunctionzzzzwrappedzzzzoverzzzzazzzzTensorFlowzzzzlayer.zzzzExpectszzzzaabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzConv2dzzzzlayerzzzzinput.abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"""abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzreturnzzzztf.nn.relu(conv2d_layer)abcdeabcdezzzzzzzzzzzzzzzzdefzzzz_conv2d(prev_layer,zzzzlayer,zzzzlayer_name):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"""abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzReturnzzzzthezzzzConv2Dzzzzlayerzzzzusingzzzzthezzzzweights,zzzzbiaseszzzzfromzzzzthezzzzVGGabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzmodelzzzzatzzzz'layer'.abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"""abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzW,zzzzbzzzz=zzzz_weights(layer,zzzzlayer_name)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzWzzzz=zzzztf.constant(W)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzbzzzz=zzzztf.constant(np.reshape(b,zzzz(b.size)))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzreturnzzzztf.nn.conv2d(abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzprev_layer,zzzzfilter=W,zzzzstrides=[1,zzzz1,zzzz1,zzzz1],zzzzpadding='SAME')zzzz+zzzzbabcdeabcdezzzzzzzzzzzzzzzzdefzzzz_conv2d_relu(prev_layer,zzzzlayer,zzzzlayer_name):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"""abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzReturnzzzzthezzzzConv2Dzzzz+zzzzRELUzzzzlayerzzzzusingzzzzthezzzzweights,zzzzbiaseszzzzfromzzzzthezzzzVGGabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzmodelzzzzatzzzz'layer'.abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"""abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzreturnzzzz_relu(_conv2d(prev_layer,zzzzlayer,zzzzlayer_name))abcdeabcdezzzzzzzzzzzzzzzzdefzzzz_avgpool(prev_layer):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"""abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzReturnzzzzthezzzzAveragePoolingzzzzlayer.abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"""abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzreturnzzzztf.nn.avg_pool(prev_layer,zzzzksize=[1,zzzz2,zzzz2,zzzz1],zzzzstrides=[1,zzzz2,zzzz2,zzzz1],zzzzpadding='SAME')abcdeabcdezzzzzzzzzzzzzzzz#zzzzConstructszzzzthezzzzgraphzzzzmodel.abcdezzzzzzzzzzzzzzzzgraphzzzz=zzzz{}abcdezzzzzzzzzzzzzzzzgraph['input']zzzzzzzzzzzz=zzzztf.Variable(np.zeros((1,zzzzIMAGE_HEIGHT,zzzzIMAGE_WIDTH,zzzzCOLOR_CHANNELS)),zzzzdtypezzzz=zzzz'float32')abcdezzzzzzzzzzzzzzzzgraph['conv1_1']zzzzzzzz=zzzz_conv2d_relu(graph['input'],zzzz0,zzzz'conv1_1')abcdezzzzzzzzzzzzzzzzgraph['conv1_2']zzzzzzzz=zzzz_conv2d_relu(graph['conv1_1'],zzzz2,zzzz'conv1_2')abcdezzzzzzzzzzzzzzzzgraph['avgpool1']zzzz=zzzz_avgpool(graph['conv1_2'])abcdezzzzzzzzzzzzzzzzgraph['conv2_1']zzzzzzzz=zzzz_conv2d_relu(graph['avgpool1'],zzzz5,zzzz'conv2_1')abcdezzzzzzzzzzzzzzzzgraph['conv2_2']zzzzzzzz=zzzz_conv2d_relu(graph['conv2_1'],zzzz7,zzzz'conv2_2')abcdezzzzzzzzzzzzzzzzgraph['avgpool2']zzzz=zzzz_avgpool(graph['conv2_2'])abcdezzzzzzzzzzzzzzzzgraph['conv3_1']zzzzzzzz=zzzz_conv2d_relu(graph['avgpool2'],zzzz10,zzzz'conv3_1')abcdezzzzzzzzzzzzzzzzgraph['conv3_2']zzzzzzzz=zzzz_conv2d_relu(graph['conv3_1'],zzzz12,zzzz'conv3_2')abcdezzzzzzzzzzzzzzzzgraph['conv3_3']zzzzzzzz=zzzz_conv2d_relu(graph['conv3_2'],zzzz14,zzzz'conv3_3')abcdezzzzzzzzzzzzzzzzgraph['conv3_4']zzzzzzzz=zzzz_conv2d_relu(graph['conv3_3'],zzzz16,zzzz'conv3_4')abcdezzzzzzzzzzzzzzzzgraph['avgpool3']zzzz=zzzz_avgpool(graph['conv3_4'])abcdezzzzzzzzzzzzzzzzgraph['conv4_1']zzzzzzzz=zzzz_conv2d_relu(graph['avgpool3'],zzzz19,zzzz'conv4_1')abcdezzzzzzzzzzzzzzzzgraph['conv4_2']zzzzzzzz=zzzz_conv2d_relu(graph['conv4_1'],zzzz21,zzzz'conv4_2')abcdezzzzzzzzzzzzzzzzgraph['conv4_3']zzzzzzzz=zzzz_conv2d_relu(graph['conv4_2'],zzzz23,zzzz'conv4_3')abcdezzzzzzzzzzzzzzzzgraph['conv4_4']zzzzzzzz=zzzz_conv2d_relu(graph['conv4_3'],zzzz25,zzzz'conv4_4')abcdezzzzzzzzzzzzzzzzgraph['avgpool4']zzzz=zzzz_avgpool(graph['conv4_4'])abcdezzzzzzzzzzzzzzzzgraph['conv5_1']zzzzzzzz=zzzz_conv2d_relu(graph['avgpool4'],zzzz28,zzzz'conv5_1')abcdezzzzzzzzzzzzzzzzgraph['conv5_2']zzzzzzzz=zzzz_conv2d_relu(graph['conv5_1'],zzzz30,zzzz'conv5_2')abcdezzzzzzzzzzzzzzzzgraph['conv5_3']zzzzzzzz=zzzz_conv2d_relu(graph['conv5_2'],zzzz32,zzzz'conv5_3')abcdezzzzzzzzzzzzzzzzgraph['conv5_4']zzzzzzzz=zzzz_conv2d_relu(graph['conv5_3'],zzzz34,zzzz'conv5_4')abcdezzzzzzzzzzzzzzzzgraph['avgpool5']zzzz=zzzz_avgpool(graph['conv5_4'])abcdezzzzzzzzzzzzzzzzreturnzzzzgraphabcdeabcde#zzzzdefzzzzcreateImage(tensor):abcde#zzzzzzzzzzzzzzzzzzzznewImagezzzz=zzzznp.zeros((len(tensor[0]),len(tensor[0][0]),3))abcde#zzzzzzzzzzzzzzzzzzzzforzzzzzzzzzinzzzzrange(len(tensor[0][0][0])):abcde#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(len(tensor[0])):abcde#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(len(tensor[0][y])):abcde#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImage[y][x][0]zzzz=zzzztensor[0][y][x][z]abcde#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImage[y][x][1]zzzz=zzzztensor[0][y][x][z]abcde#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImage[y][x][2]zzzz=zzzztensor[0][y][x][z]abcde#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImagezzzz=zzzznp.asarray(newImage).astype('float64')abcde#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImagezzzz+=zzzzMEAN_VALUES[0]abcde#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImagezzzz=zzzznewImage[:,zzzz:,zzzz::-1]abcde#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImagezzzz=zzzznp.clip(newImage,zzzz0,zzzz255).astype('uint8')abcde#zzzzzzzzzzzzzzzzzzzzprint(newImage.shape)abcde#zzzzzzzzzzzzzzzzzzzzreturnzzzznewImageabcdeabcdedefzzzzgetNormalizedFx(Fx,y,x):abcdezzzzzzzzzzzzzzzzvectorzzzz=zzzzFx[0][y][x]abcdezzzzzzzzzzzzzzzzreturnzzzzvector/np.linalg.norm(vector)abcdeabcdeabcdedefzzzzgetPatchPosition(image,zzzzimY,zzzzimX,zzzzpatch):abcdezzzzzzzzzzzzzzzzheightzzzz=zzzzlen(image)abcdezzzzzzzzzzzzzzzzwidthzzzz=zzzzlen(image[0])abcdezzzzzzzzzzzzzzzzpoints=[]abcdezzzzzzzzzzzzzzzzlen_mx1zzzz=zzzz-int(patch[0]/2)abcdezzzzzzzzzzzzzzzzlen_px1zzzz=zzzzint(patch[0]/2)+1abcdezzzzzzzzzzzzzzzzlen_mx2zzzz=zzzz-int(patch[1]/2)abcdezzzzzzzzzzzzzzzzlen_px2zzzz=zzzzint(patch[1]/2)+1abcdeabcdezzzzzzzzzzzzzzzzpointszzzz=zzzz[[imY+y,imX+x]zzzzifzzzz0<=imX+x<widthzzzzandzzzz0<=imY+y<heightzzzzelsezzzz[-1,-1]zzzzforzzzzyzzzzinzzzzrange(len_mx2,len_px2)zzzzforzzzzxzzzzinzzzzrange(len_mx1,zzzzlen_px1)]abcdezzzzzzzzzzzzzzzzreturnzzzzpointsabcdeabcde#指定された位置の半径(randomwalkarea)分の有効な座標を返すabcdedefzzzzgetSearchList(image,zzzzimY,zzzzimX,zzzzrandomWalkArea):abcdezzzzzzzzzzzzzzzzheightzzzz=zzzzlen(image)abcdezzzzzzzzzzzzzzzzwidthzzzz=zzzzlen(image[0])abcdezzzzzzzzzzzzzzzzpoints=[]abcdezzzzzzzzzzzzzzzzlen_mx1zzzz=zzzz-int(randomWalkArea[0]/2)abcdezzzzzzzzzzzzzzzzlen_px1zzzz=zzzzint(randomWalkArea[0]/2)+1abcdezzzzzzzzzzzzzzzzlen_mx2zzzz=zzzz-int(randomWalkArea[1]/2)abcdezzzzzzzzzzzzzzzzlen_px2zzzz=zzzzint(randomWalkArea[1]/2)+1abcdezzzzzzzzzzzzzzzz#zzzzforzzzzxzzzzinzzzzrange(len_mx1,len_px1):abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzztempXzzzz=zzzzimX+xabcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(len_mx2,len_px2):abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzz0zzzz<=zzzztempXzzzz<zzzzwidthzzzzandzzzz0<=zzzzimY+yzzzz<zzzzheight:abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpoints.append([tempX,imY+y])abcdezzzzzzzzzzzzzzzzpointszzzz=zzzz[[imY+y,imX+x]zzzzforzzzzyzzzzinzzzzrange(len_mx2,len_px2)zzzzforzzzzxzzzzinzzzzrange(len_mx1,zzzzlen_px1)zzzzifzzzz0<=imX+x<widthzzzzandzzzz0<=imY+y<height]abcdezzzzzzzzzzzzzzzzmap(int,points)abcdezzzzzzzzzzzzzzzzreturnzzzzpointsabcdeabcdedefzzzzgetPhi_L_MtoN(M,N,patch):abcdezzzzzzzzzzzzzzzzPhizzzz=zzzznp.zeros((len(M),len(M[0]),1))abcdezzzzzzzzzzzzzzzzforzzzzMyzzzzinzzzzrange(len(M)):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzMxzzzzinzzzzrange(len(M[My])):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzMpositionszzzz=zzzzgetPatchPosition(M,Mx,My,patch)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzMFxVector=[]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzizzzzinzzzzrange(len(Mpositions)):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzMFxVector.append(getNormalizedFx(M,zzzzMpositions[i][0],zzzzMpositions[i][1]))abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimumzzzz=zzzz100000abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimum_positionszzzz=zzzz[]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzNyzzzzinzzzzrange(len(N)):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzNxzzzzinzzzzrange(len(N[Ny])):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzNpositionszzzz=zzzzgetPatchPosition(N,Nx,Ny,patch)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztotalzzzz=zzzz0abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzizzzzinzzzzrange(len(Npositions)):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzNFxzzzz=zzzzgetNormalizedFx(N,Npositions[i][0],Npositions[i][1])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztotalzzzz+=zzzzabs(MFxVector[i]zzzz-zzzzNFx)zzzz**zzzz2abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzminimumzzzz>zzzztotal:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimumzzzz=zzzztotalabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimum_positionszzzz=zzzz[Nx,Ny]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzPhi[My][Mx]zzzz=zzzzminimum_positionsabcdezzzzzzzzzzzzzzzzreturnzzzzPhiabcdeabcde#patchmatchで用いるエネルギー関数を出力するabcdedefzzzzgetDistance(Ay,Ax,ANormlizeMap,AdashNormlizedMap,By,Bx,BNormlizedMap,BdashNormlizedMap,patch,height,width):abcdezzzzzzzzzzzzzzzzAzzzz=zzzzgetPatchPosition(ANormlizeMap,Ay,Ax,patch)abcdezzzzzzzzzzzzzzzzBzzzz=zzzzgetPatchPosition(BNormlizedMap,By,Bx,patch)abcdezzzzzzzzzzzzzzzzsumationAzzzz=zzzz0abcdezzzzzzzzzzzzzzzzsumationBzzzz=zzzz0abcdezzzzzzzzzzzzzzzzlengthzzzz=zzzzlen(A)abcdezzzzzzzzzzzzzzzzforzzzzizzzzinzzzzrange(length):abcdezzzzzzzzzzzzzzzzzzzzzzzzaddressAYzzzz=zzzzA[i][0]abcdezzzzzzzzzzzzzzzzzzzzzzzzaddressAXzzzz=zzzzA[i][1]abcdezzzzzzzzzzzzzzzzzzzzzzzzaddressBYzzzz=zzzzB[i][0]abcdezzzzzzzzzzzzzzzzzzzzzzzzaddressBXzzzz=zzzzB[i][1]abcdezzzzzzzzzzzzzzzzzzzzzzzztempA=0abcdezzzzzzzzzzzzzzzzzzzzzzzztempB=0abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzifzzzzaddressAX!=-1zzzzandzzzzaddressBX!=-1:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempAzzzz+=zzzznp.linalg.norm(abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz(ANormlizeMap[addressAY][addressAX])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz-(BNormlizedMap[addressBY][addressBX])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempBzzzz+=zzzznp.linalg.norm(abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz(AdashNormlizedMap[addressAY][addressAX])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz-(BdashNormlizedMap[addressBY][addressBX])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz)abcdezzzzzzzzzzzzzzzzzzzzzzzzelifzzzzaddressAXzzzz==zzzz-1zzzzandzzzzaddressBYzzzz!=zzzz-1:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempAzzzz+=zzzznp.linalg.norm(abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz-(BNormlizedMap[addressBY][addressBX])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempBzzzz+=zzzznp.linalg.norm(abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz-(BdashNormlizedMap[addressBY][addressBX])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz)abcdezzzzzzzzzzzzzzzzzzzzzzzzelifzzzzaddressAXzzzz!=zzzz-1zzzzandzzzzaddressBYzzzz==zzzz-1:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempAzzzz+=zzzznp.linalg.norm(ANormlizeMap[addressAY][addressAX])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempBzzzz+=zzzznp.linalg.norm(AdashNormlizedMap[addressAY][addressAX])abcdezzzzzzzzzzzzzzzzzzzzzzzzsumationAzzzz+=zzzztempA*tempAabcdezzzzzzzzzzzzzzzzzzzzzzzzsumationBzzzz+=zzzztempB*tempBabcdezzzzzzzzzzzzzzzzreturnzzzzsumationA+sumationBabcdeabcdedefzzzzgetNormlizedMap(imgA,zzzzimgAdash,zzzzimgB,zzzzimgBdash,zzzzpatch,zzzzPhi):abcdezzzzzzzzzzzzzzzzlengthYzzzz=zzzzlen(imgA[0])abcdezzzzzzzzzzzzzzzzlengthXzzzz=zzzzlen(imgA[0][0])abcdezzzzzzzzzzzzzzzzlengthZzzzz=zzzzlen(imgA[0][0][0])abcdezzzzzzzzzzzzzzzzANormlizeMap=np.zeros((lengthY,lengthX,lengthZ))abcdezzzzzzzzzzzzzzzzAdashNormlizedMap=np.zeros((lengthY,lengthX,lengthZ))abcdezzzzzzzzzzzzzzzzBNormlizedMap=np.zeros((lengthY,lengthX,lengthZ))abcdezzzzzzzzzzzzzzzzBdashNormlizedMap=np.zeros((lengthY,lengthX,lengthZ))abcdeabcdezzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(lengthY):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(lengthX):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzANormlizeMap[y][x]zzzzzzzzzzzzzzzzzzzz=zzzzgetNormalizedFx(imgA,y,x)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzAdashNormlizedMap[y][x]=zzzzgetNormalizedFx(imgAdash,y,x)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzBNormlizedMap[y][x]zzzzzzzzzzzzzzzz=zzzzgetNormalizedFx(imgB,zzzzy,x)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzBdashNormlizedMap[y][x]=zzzzgetNormalizedFx(imgBdash,y,x)abcdezzzzzzzzzzzzzzzzreturnzzzzANormlizeMap,zzzzAdashNormlizedMap,zzzzBNormlizedMap,zzzzBdashNormlizedMapabcdeabcdeabcdeabcdedefzzzzpart_of_patchmatch(ANormlizeMap,AdashNormlizedMap,BNormlizedMap,BdashNormlizedMap,zzzzrandomWalkArea,zzzzpatch,zzzzPhi,zzzzy,zzzzx):abcdezzzzzzzzzzzzzzzzpositionList=[]abcdezzzzzzzzzzzzzzzzpositionList.append(Phi[y][x])abcdezzzzzzzzzzzzzzzzminimumzzzz=zzzz100000abcdeabcdezzzzzzzzzzzzzzzzifzzzzy>0zzzzandzzzzx+1<len(ANormlizeMap):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpositionList.append(Phi[y-1][x+1])abcdezzzzzzzzzzzzzzzzifzzzzx>0:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpositionList.append(Phi[y][x-1])abcdezzzzzzzzzzzzzzzzsaveX=0abcdezzzzzzzzzzzzzzzzsaveY=0abcdezzzzzzzzzzzzzzzzsaveArea=Noneabcdezzzzzzzzzzzzzzzzheight=zzzzlen(ANormlizeMap[0])abcdezzzzzzzzzzzzzzzzwidthzzzz=zzzzlen(ANormlizeMap)abcdezzzzzzzzzzzzzzzzabcdezzzzzzzzzzzzzzzz#一番値が近いエリアを探索abcdezzzzzzzzzzzzzzzzforzzzzposzzzzinzzzzpositionList:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzmap(int,pos)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzdiszzzzzzzz=zzzzgetDistance(x,y,imgA,zzzzzzzzzzzzzzzzzzzzint(pos[0]),int(pos[1]),zzzzimgBzzzzzzzzzzzzzzzz,zzzzpatch)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzdiszzzz+=zzzzgetDistance(x,y,imgAdash,zzzzint(pos[0]),int(pos[1]),zzzzimgBdash,zzzzpatch)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzdiszzzz=zzzzgetDistance(y,zzzzx,zzzzANormlizeMap,AdashNormlizedMap,zzzzint(pos[0]),zzzzint(pos[1]),zzzzBNormlizedMap,BdashNormlizedMap,zzzzpatch,zzzzheight,width)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzminimumzzzz>zzzzdis:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimumzzzz=zzzzdisabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzprint(x,y,int(searchArea[0]),int(searchArea[1]),dis)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzPhi[y][x]zzzz=zzzzsearchAreazzzzabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveYzzzz=zzzzint(pos[0])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveXzzzz=zzzzint(pos[1])abcdezzzzzzzzzzzzzzzz#一番値が近いエリアのみを保存abcdezzzzzzzzzzzzzzzzminimumzzzz=zzzz100000abcdezzzzzzzzzzzzzzzz#zzzzdistancelist=[]abcdezzzzzzzzzzzzzzzztempzzzz=zzzzPhi[saveY][saveX]abcdezzzzzzzzzzzzzzzzsearchListzzzz=zzzzgetSearchList(ANormlizeMap,temp[0],temp[1],randomWalkArea)abcdezzzzzzzzzzzzzzzz#zzzzprint(searchList)abcdezzzzzzzzzzzzzzzz#zzzzdistancelist.append(Parallel(n_jobs=4)(zzzz[delayed(part_of_patchmatch)(imgA,zzzzimgAdash,zzzzimgB,zzzzimgBdash,zzzzrandomWalkArea,zzzzpatch,zzzzx,zzzzy,zzzzsearchArea)zzzzforzzzzsearchAreazzzzinzzzzsearchList]))abcdezzzzzzzzzzzzzzzzforzzzzsearchAreazzzzinzzzzsearchList:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzmap(int,searchArea)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempY=int(searchArea[0])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempX=int(searchArea[1])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzdiszzzzzzzz=zzzzgetDistance(x,y,imgA,zzzzzzzzzzzzzzzzzzzzint(searchArea[0]),int(searchArea[1]),zzzzimgBzzzzzzzzzzzzzzzz,zzzzpatch)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzdiszzzz+=zzzzgetDistance(x,y,imgAdash,zzzzint(searchArea[0]),int(searchArea[1]),zzzzimgBdash,zzzzpatch)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzdiszzzz=zzzzgetDistance(y,zzzzx,zzzzANormlizeMap,AdashNormlizedMap,zzzztempY,zzzztempX,zzzzBNormlizedMap,BdashNormlizedMap,zzzzpatch,zzzzheight,zzzzwidth)abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzminimumzzzz>zzzzdis:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimumzzzz=zzzzdisabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveYzzzz=zzzztempYabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveXzzzz=zzzztempXabcdezzzzzzzzzzzzzzzzreturnzzzzsaveY,saveX,y,xabcdeabcdedefzzzzpatchMatch(imgA,zzzzimgAdash,zzzzimgB,zzzzimgBdash,zzzzrandomWalkArea,zzzzpatch,zzzzPhi):abcdezzzzzzzzzzzzzzzzprint(patch)abcdeabcdezzzzzzzzzzzzzzzzindex=[]abcdezzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(len(imgA[0])):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(len(imgA[0][y])):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzindex.append([y,x])abcdeabcdezzzzzzzzzzzzzzzzANormlizeMap,zzzzAdashNormlizedMap,zzzzBNormlizedMap,zzzzBdashNormlizedMapzzzz=zzzzgetNormlizedMap(imgA,zzzzimgAdash,zzzzimgB,zzzzimgBdash,zzzzpatch,zzzzPhi)abcdezzzzzzzzzzzzzzzzprint(type(ANormlizeMap))abcdezzzzzzzzzzzzzzzzprint(type(BNormlizedMap))abcdeabcdezzzzzzzzzzzzzzzzpositions=[]abcdezzzzzzzzzzzzzzzzpositions.append(Parallel(n_jobs=-1)(zzzz[delayed(part_of_patchmatch)(ANormlizeMap,zzzzAdashNormlizedMap,zzzzBNormlizedMap,zzzzBdashNormlizedMap,zzzzrandomWalkArea,zzzzpatch,zzzzPhi,zzzzpos[0],zzzzpos[1])zzzzforzzzzposzzzzinzzzzindex]))abcdezzzzzzzzzzzzzzzzprint("come")abcdezzzzzzzzzzzzzzzz#zzzzprint(positions)abcdezzzzzzzzzzzzzzzzretzzzz=zzzznp.zeros_like(Phi)abcdezzzzzzzzzzzzzzzzpositionszzzz=zzzznp.asarray(positions)abcdezzzzzzzzzzzzzzzz#zzzzprint(positions.shape)abcdezzzzzzzzzzzzzzzzforzzzzposzzzzinzzzzpositions[0]:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzprint(pos[0],pos[1],pos[2],pos[3])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzret[pos[2]][pos[3]]zzzz=zzzz[pos[0],pos[1]]abcdezzzzzzzzzzzzzzzz#zzzzprint(ret)abcdezzzzzzzzzzzzzzzz#zzzzforzzzzyzzzzinzzzzrange(len(imgA[0])):abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(len(imgA[0][y])):abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzprint(x,y)abcdeabcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpositionList=[]abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzy==0zzzzandzzzzx==0:abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzprint(np.asarray(Phi).shape)abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpositionList.append(Phi[y][x])abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimumzzzz=zzzz100000abcdeabcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzy>0zzzzandzzzzx+1<len(imgA[0]):abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpositionList.append(Phi[y-1][x+1])abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzx>0:abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpositionList.append(Phi[y][x-1])abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveX=0abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveY=0abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveArea=Noneabcdeabcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#一番値が近いエリアを探索abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzposzzzzinzzzzpositionList:abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzdiszzzzzzzz=zzzzgetDistance(x,y,imgA,zzzzzzzzzzzzzzzzzzzzint(pos[0]),int(pos[1]),zzzzimgBzzzzzzzzzzzzzzzz,zzzzpatch)abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzdiszzzz+=zzzzgetDistance(x,y,imgAdash,zzzzint(pos[0]),int(pos[1]),zzzzimgBdash,zzzzpatch)abcdeabcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzminimumzzzz>zzzzdis:abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimumzzzz=zzzzdisabcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzprint(x,y,int(searchArea[0]),int(searchArea[1]),dis)abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzPhi[y][x]zzzz=zzzzsearchAreazzzzabcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveXzzzz=zzzzint(pos[0])abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveYzzzz=zzzzint(pos[1])abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#一番値が近いエリアのみを保存abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpositionList=[[saveX,saveY]]abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimumzzzz=zzzz100000abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzdistancelist=[]abcdeabcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzposzzzzinzzzzpositionList:abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsearchListzzzz=zzzzgetSearchList(imgA,pos[0],pos[1],randomWalkArea)abcdeabcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzdistancelist.append(Parallel(n_jobs=4)(zzzz[delayed(part_of_patchmatch)(imgA,zzzzimgAdash,zzzzimgB,zzzzimgBdash,zzzzrandomWalkArea,zzzzpatch,zzzzx,zzzzy,zzzzsearchArea)zzzzforzzzzsearchAreazzzzinzzzzsearchList]))abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzsearchAreazzzzinzzzzsearchList:abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzdiszzzzzzzz=zzzzgetDistance(x,y,imgA,zzzzzzzzzzzzzzzzzzzzint(searchArea[0]),int(searchArea[1]),zzzzimgBzzzzzzzzzzzzzzzz,zzzzpatch)abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzdiszzzz+=zzzzgetDistance(x,y,imgAdash,zzzzint(searchArea[0]),int(searchArea[1]),zzzzimgBdash,zzzzpatch)abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveXzzzz=zzzzint(searchArea[0])abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveYzzzz=zzzzint(searchArea[1])abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzdistancelist.append([[dis,saveY,saveX]])abcdeabcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzdiszzzzinzzzzdistancelist:abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzminimumzzzz>zzzzdis[0][0]:abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzPhi[y][x][0]zzzz=zzzzdis[0][1]abcdezzzzzzzzzzzzzzzz#zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzPhi[y][x][1]zzzz=zzzzdis[0][2]abcdezzzzzzzzzzzzzzzzreturnzzzzretabcdeabcdedefzzzzpatchMatchA(imgA,zzzzimgAdash,zzzzimgB,zzzzimgBdash,zzzzrandomWalkArea,zzzzpatch,zzzzPhi):abcdezzzzzzzzzzzzzzzzindex=[]abcdezzzzzzzzzzzzzzzzheight=len(imgA[0])abcdezzzzzzzzzzzzzzzzwidthzzzz=len(imgA[0][0])abcdezzzzzzzzzzzzzzzzANormlizeMap,zzzzAdashNormlizedMap,zzzzBNormlizedMap,zzzzBdashNormlizedMapzzzz=zzzzgetNormlizedMap(imgA,zzzzimgAdash,zzzzimgB,zzzzimgBdash,zzzzpatch,zzzzPhi)abcdezzzzzzzzzzzzzzzzretzzzz=zzzznp.zeros_like(Phi)abcdeabcdezzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(height):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(width):abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpositionList=[]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpositionList.append(Phi[y][x])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimumzzzz=zzzz100000abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzy>0zzzzandzzzzx+1<len(ANormlizeMap):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpositionList.append(Phi[y-1][x+1])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzx>0:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpositionList.append(Phi[y][x-1])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveX=0abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveY=0abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempY=0abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempX=0abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#一番値が近いエリアを探索abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzposzzzzinzzzzpositionList:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempYzzzz=zzzzint(pos[0])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempXzzzz=zzzzint(pos[1])abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzdiszzzz=zzzzgetDistance(y,zzzzx,zzzzANormlizeMap,AdashNormlizedMap,zzzztempY,zzzztempX,zzzzBNormlizedMap,BdashNormlizedMap,zzzzpatch,zzzzheight,width)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzminimumzzzz>zzzzdis:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimumzzzz=zzzzdisabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveYzzzz=zzzztempYabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveXzzzz=zzzztempXabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#一番値が近いエリアのみを保存abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimumzzzz=zzzz100000abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzztempzzzz=zzzzPhi[saveY][saveX]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzsearchListzzzz=zzzzgetSearchList(ANormlizeMap,int(temp[0]),int(temp[1]),randomWalkArea)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsearchListzzzz=zzzzgetSearchList(ANormlizeMap,saveY,saveX,randomWalkArea)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzsearchAreazzzzinzzzzsearchList:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempY=searchArea[0]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztempX=searchArea[1]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzdiszzzz=zzzzgetDistance(y,zzzzx,zzzzANormlizeMap,AdashNormlizedMap,zzzztempY,zzzztempX,zzzzBNormlizedMap,BdashNormlizedMap,zzzzpatch,zzzzheight,zzzzwidth)abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzminimumzzzz>zzzzdis:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimumzzzz=zzzzdisabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveYzzzz=zzzztempYabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsaveXzzzz=zzzztempXabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzret[y][x]=[saveY,saveX]abcdeabcdezzzzzzzzzzzzzzzzreturnzzzzretabcdeabcdeabcdeabcdeabcdedefzzzzgetPhi_Random(image):abcdezzzzzzzzzzzzzzzzretzzzz=zzzz[]abcdezzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(len(image[0])):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(len(image[0][y])):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzret.append([y,x])abcdezzzzzzzzzzzzzzzzrandom.shuffle(ret)abcdezzzzzzzzzzzzzzzzretzzzz=zzzznp.asarray(ret)abcdezzzzzzzzzzzzzzzzrandomRetzzzz=zzzznp.reshape(ret,(len(image[0]),len(image[0][0]),2))abcdezzzzzzzzzzzzzzzzreturnzzzzrandomRetabcdeabcdeabcdedefzzzzwarp(image,Phi):abcdezzzzzzzzzzzzzzzzretzzzz=zzzznp.zeros_like(image)abcdezzzzzzzzzzzzzzzzheightzzzz=zzzzlen(Phi)abcdezzzzzzzzzzzzzzzzwidthzzzz=zzzzlen(Phi[0])abcdezzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(height):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(width):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewYzzzz=zzzzint(Phi[y][x][0])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewXzzzz=zzzzint(Phi[y][x][1])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzret[0][newY][newX]zzzz=zzzzimage[0][y][x]abcdezzzzzzzzzzzzzzzzreturnzzzzretabcdeabcdedefzzzzmakeFinImage(img):abcdezzzzzzzzzzzzzzzztempzzzz=zzzznp.zeros_like(img[0])abcdezzzzzzzzzzzzzzzzheightzzzz=zzzzlen(img[0])abcdezzzzzzzzzzzzzzzzwidthzzzz=zzzzlen(img[0][0])abcdezzzzzzzzzzzzzzzzchannel=len(img[0][0][0])abcdezzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(height):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(width):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpositionszzzz=zzzzgetPatchPosition(img[0],zzzzy,zzzzx,zzzz[5,5])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzzzzzzinzzzzrange(channel):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsumationzzzz=0abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzposzzzzinzzzzpositions:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzpos[0]zzzz!=zzzz-1zzzzorzzzzpos[1]!=-1:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsumationzzzz+=zzzzimg[0][y][x][z]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzsumationzzzz/=zzzz25.0abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztemp[y][x][z]zzzz=zzzzsumationabcdezzzzzzzzzzzzzzzzreturnzzzztempabcdeabcdedefzzzzgetWeight(layer,a):abcdezzzzzzzzzzzzzzzzk=300abcdezzzzzzzzzzzzzzzzt=0.05abcdezzzzzzzzzzzzzzzzlayerzzzz=zzzzlayer/np.linalg.norm(layer)abcdezzzzzzzzzzzzzzzzfzzzz=zzzznp.clip(layer,zzzz0.0,zzzz1.0)abcdezzzzzzzzzzzzzzzz#zzzzMzzzz=zzzznp.zeros_like(layer)abcdezzzzzzzzzzzzzzzzMzzzz=zzzznp.zeros_like(layer)abcdezzzzzzzzzzzzzzzzlayer_len=len(layer)abcdezzzzzzzzzzzzzzzzheightzzzz=zzzzlen(layer[0])abcdezzzzzzzzzzzzzzzzwidthzzzz=zzzzlen(layer[0][0])abcdezzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(layer_len):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(height):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzfzzzz=zzzznp.linalg.norm(layer[y][x])abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzzzzzzinzzzzrange(width):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzM[y][x][z]=1/(1zzzz+zzzznp.exp(zzzz-k*(f*f-t))zzzz)abcdezzzzzzzzzzzzzzzzreturnzzzza*MabcdeabcdedefzzzzweightBlend(F,W,R):abcdezzzzzzzzzzzzzzzzWzzzz=zzzznp.clip(np.asarray(W,dtype='float32'),0.0,1.0)abcdezzzzzzzzzzzzzzzzreturnzzzzF*Wzzzz+zzzzR*(1-W)abcdeabcdeabcdedefzzzzbatch_norm_wrapper(inputs,zzzzis_training,zzzzdecayzzzz=zzzz0.999):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzepsilonzzzz=zzzz1e-5abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzscalezzzz=zzzztf.Variable(tf.ones([inputs.get_shape()[-1]]))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzbetazzzz=zzzztf.Variable(tf.zeros([inputs.get_shape()[-1]]))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpop_meanzzzz=zzzztf.Variable(tf.zeros([inputs.get_shape()[-1]]),zzzztrainable=False)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpop_varzzzz=zzzztf.Variable(tf.ones([inputs.get_shape()[-1]]),zzzztrainable=False)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzrankzzzz=zzzzlen(inputs.get_shape())abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzaxeszzzz=zzzz[]zzzzzzzz#zzzznn:[0],zzzzconv:[0,1,2]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzizzzzinzzzzrange(rankzzzz-zzzz1):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzaxes.append(i)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzis_training:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzbatch_mean,zzzzbatch_varzzzz=zzzztf.nn.moments(inputs,axes)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztrain_meanzzzz=zzzztf.assign(pop_mean,abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpop_meanzzzz*zzzzdecayzzzz+zzzzbatch_meanzzzz*zzzz(1zzzz-zzzzdecay))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztrain_varzzzz=zzzztf.assign(pop_var,abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpop_varzzzz*zzzzdecayzzzz+zzzzbatch_varzzzz*zzzz(1zzzz-zzzzdecay))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzwithzzzztf.control_dependencies([train_mean,zzzztrain_var]):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzreturnzzzztf.nn.batch_normalization(inputs,abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzbatch_mean,zzzzbatch_var,zzzzbeta,zzzzscale,zzzzepsilon)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzelse:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzreturnzzzztf.nn.batch_normalization(inputs,abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzpop_mean,zzzzpop_var,zzzzbeta,zzzzscale,zzzzepsilon)abcdedefzzzzweight_variable(shape):abcdezzzzzzzzinitialzzzz=zzzztf.truncated_normal(shape,zzzzstddev=0.1)abcdezzzzzzzzreturnzzzztf.Variable(initial)abcdeabcdedefzzzzbias_variable(shape):abcdezzzzzzzzinitialzzzz=zzzztf.constant(0.1,zzzzshape=shape)abcdezzzzzzzzreturnzzzztf.Variable(initial)abcdeabcdedefzzzzconv2d(x,zzzzW):abcdezzzzzzzzreturnzzzztf.nn.conv2d(x,zzzzW,zzzzstrides=[1,zzzz1,zzzz1,zzzz1],zzzzpadding='SAME')abcdeabcdedefzzzzmax_pool_2x2(x):abcdezzzzzzzzreturnzzzztf.nn.max_pool(x,zzzzksize=[1,zzzz2,zzzz2,zzzz1],abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzstrides=[1,zzzz2,zzzz2,zzzz1],zzzzpadding='SAME')abcdeabcdedefzzzzbuild_model(input_img,IMAGE_WIDTH,IMAGE_HEIGHT,CHANNEL,zzzzlayer_num):abcdezzzzzzzzdefzzzzconv_layer(layer_name,zzzzlayer_input,zzzzW):abcdezzzzzzzzzzzzzzzzconvzzzz=zzzztf.nn.conv2d(layer_input,zzzzW,zzzzstrides=[1,zzzz1,zzzz1,zzzz1],zzzzpadding='SAME')abcdezzzzzzzzzzzzzzzzreturnzzzzconvabcdeabcdezzzzzzzzdefzzzzrelu_layer(layer_name,zzzzlayer_input,zzzzb):abcdezzzzzzzzzzzzzzzzreluzzzz=zzzztf.nn.relu(layer_inputzzzz+zzzzb)abcdezzzzzzzzzzzzzzzzreturnzzzzreluabcdeabcdezzzzzzzzdefzzzzpool_layer(layer_name,zzzzlayer_input):abcdezzzzzzzzzzzzzzzzpoolzzzz=zzzztf.nn.avg_pool(layer_input,zzzzksize=[1,zzzz2,zzzz2,zzzz1],zzzzabcdezzzzzzzzzzzzzzzzzzzzzzzzstrides=[1,zzzz2,zzzz2,zzzz1],zzzzpadding='SAME')abcdezzzzzzzzzzzzzzzzzzzzzzzz#zzzzpoolzzzz=zzzztf.nn.max_pool(layer_input,zzzzksize=[1,zzzz2,zzzz2,zzzz1],zzzzabcdezzzzzzzzzzzzzzzzzzzzzzzz#zzzzzzzzzzzzstrides=[1,zzzz2,zzzz2,zzzz1],zzzzpadding='SAME')abcdezzzzzzzzzzzzzzzzreturnzzzzpoolabcdeabcdezzzzzzzzdefzzzzget_weights(vgg_layers,zzzzi):abcdezzzzzzzzzzzzzzzzweightszzzz=zzzzvgg_layers[i][0][0][2][0][0]abcdezzzzzzzzzzzzzzzzWzzzz=zzzztf.constant(weights)abcdezzzzzzzzzzzzzzzzreturnzzzzWabcdeabcdezzzzzzzzdefzzzzget_bias(vgg_layers,zzzzi):abcdezzzzzzzzzzzzzzzzbiaszzzz=zzzzvgg_layers[i][0][0][2][0][1]abcdezzzzzzzzzzzzzzzzbzzzz=zzzztf.constant(np.reshape(bias,zzzz(bias.size)))abcdezzzzzzzzzzzzzzzzreturnzzzzbabcdeabcdezzzzzzzznetzzzz=zzzz{}abcdezzzzzzzzabcdezzzzzzzzvgg_rawnetzzzzzzzzzzzzzzzzzzzz=zzzzscipy.io.loadmat(VGG_MODEL)abcdezzzzzzzzvgg_layerszzzzzzzzzzzzzzzzzzzz=zzzzvgg_rawnet['layers'][0]abcdezzzzzzzznet['input']zzzzzzzzzzzz=zzzztf.Variable(np.asarray([input_img]),zzzzdtype=np.float32)abcdezzzzzzzzzzzzzzzz#zzzznp.zeros((1,IMAGE_WIDTH,IMAGE_HEIGHT,CHANNEL)abcdezzzzzzzzifzzzzlayer_num==1:abcdezzzzzzzzzzzzzzzznet['conv1_1']zzzz=zzzzconv_layer('conv1_1',zzzznet['input'],zzzzW=get_weights(vgg_layers,zzzz0))abcdezzzzzzzzzzzzzzzznet['relu1_1']zzzz=zzzzrelu_layer('relu1_1',zzzznet['conv1_1'],zzzzb=get_bias(vgg_layers,zzzz0))abcdeabcdezzzzzzzzzzzzzzzznet['conv1_2']zzzz=zzzzconv_layer('conv1_2',zzzznet['relu1_1'],zzzzW=get_weights(vgg_layers,zzzz2))abcdezzzzzzzzzzzzzzzznet['relu1_2']zzzz=zzzzrelu_layer('relu1_2',zzzznet['conv1_2'],zzzzb=get_bias(vgg_layers,zzzz2))abcdezzzzzzzzzzzzzzzzabcdezzzzzzzzzzzzzzzznet['pool1']zzzzzzzzzzzz=zzzzpool_layer('pool1',zzzznet['relu1_2'])abcdeabcdezzzzzzzzzzzzzzzz#zzzzifzzzzargs.verbose:zzzzprint('LAYERzzzzGROUPzzzz2')zzzzzzzzabcdezzzzzzzzzzzzzzzznet['conv2_1']zzzz=zzzzconv_layer('conv2_1',zzzznet['pool1'],zzzzW=get_weights(vgg_layers,zzzz5))abcdezzzzzzzzzzzzzzzznet['relu2_1']zzzz=zzzzrelu_layer('relu2_1',zzzznet['conv2_1'],zzzzb=get_bias(vgg_layers,zzzz5))abcdeabcdezzzzzzzzifzzzzlayer_numzzzz==zzzz2:zzzzzzzzabcdezzzzzzzzzzzzzzzznet['conv2_1']zzzz=zzzzconv_layer('conv2_1',zzzznet['input'],zzzzW=get_weights(vgg_layers,zzzz5))abcdezzzzzzzzzzzzzzzznet['relu2_1']zzzz=zzzzrelu_layer('relu2_1',zzzznet['conv2_1'],zzzzb=get_bias(vgg_layers,zzzz5))abcdezzzzzzzzzzzzzzzznet['conv2_2']zzzz=zzzzconv_layer('conv2_2',zzzznet['relu2_1'],zzzzW=get_weights(vgg_layers,zzzz7))abcdezzzzzzzzzzzzzzzznet['relu2_2']zzzz=zzzzrelu_layer('relu2_2',zzzznet['conv2_2'],zzzzb=get_bias(vgg_layers,zzzz7))abcdezzzzzzzzzzzzzzzzabcdezzzzzzzzzzzzzzzznet['pool2']zzzzzzzzzzzz=zzzzpool_layer('pool2',zzzznet['relu2_2'])abcdezzzzzzzzzzzzzzzznet['conv3_1']zzzz=zzzzconv_layer('conv3_1',zzzznet['pool2'],zzzzW=get_weights(vgg_layers,zzzz10))abcdezzzzzzzzzzzzzzzznet['relu3_1']zzzz=zzzzrelu_layer('relu3_1',zzzznet['conv3_1'],zzzzb=get_bias(vgg_layers,zzzz10))abcdeabcdezzzzzzzzifzzzzlayer_numzzzz==zzzz3:abcdezzzzzzzzzzzzzzzznet['conv3_1']zzzz=zzzzconv_layer('conv3_1',zzzznet['input'],zzzzW=get_weights(vgg_layers,zzzz10))abcdezzzzzzzzzzzzzzzznet['relu3_1']zzzz=zzzzrelu_layer('relu3_1',zzzznet['conv3_1'],zzzzb=get_bias(vgg_layers,zzzz10))abcdeabcdezzzzzzzzzzzzzzzznet['conv3_2']zzzz=zzzzconv_layer('conv3_2',zzzznet['relu3_1'],zzzzW=get_weights(vgg_layers,zzzz12))abcdezzzzzzzzzzzzzzzznet['relu3_2']zzzz=zzzzrelu_layer('relu3_2',zzzznet['conv3_2'],zzzzb=get_bias(vgg_layers,zzzz12))abcdeabcdezzzzzzzzzzzzzzzznet['conv3_3']zzzz=zzzzconv_layer('conv3_3',zzzznet['relu3_2'],zzzzW=get_weights(vgg_layers,zzzz14))abcdezzzzzzzzzzzzzzzznet['relu3_3']zzzz=zzzzrelu_layer('relu3_3',zzzznet['conv3_3'],zzzzb=get_bias(vgg_layers,zzzz14))abcdeabcdezzzzzzzzzzzzzzzznet['conv3_4']zzzz=zzzzconv_layer('conv3_4',zzzznet['relu3_3'],zzzzW=get_weights(vgg_layers,zzzz16))abcdezzzzzzzzzzzzzzzznet['relu3_4']zzzz=zzzzrelu_layer('relu3_4',zzzznet['conv3_4'],zzzzb=get_bias(vgg_layers,zzzz16))abcdeabcdezzzzzzzzzzzzzzzznet['pool3']zzzzzzzzzzzz=zzzzpool_layer('pool3',zzzznet['relu3_4'])abcdeabcdezzzzzzzzzzzzzzzz#zzzzifzzzzargs.verbose:zzzzprint('LAYERzzzzGROUPzzzz4')abcdezzzzzzzzzzzzzzzznet['conv4_1']zzzz=zzzzconv_layer('conv4_1',zzzznet['pool3'],zzzzW=get_weights(vgg_layers,zzzz19))abcdezzzzzzzzzzzzzzzznet['relu4_1']zzzz=zzzzrelu_layer('relu4_1',zzzznet['conv4_1'],zzzzb=get_bias(vgg_layers,zzzz19))abcdeabcdezzzzzzzzifzzzzlayer_numzzzz==zzzz4:abcdezzzzzzzzzzzzzzzznet['conv4_1']zzzz=zzzzconv_layer('conv4_1',zzzznet['input'],zzzzW=get_weights(vgg_layers,zzzz19))abcdezzzzzzzzzzzzzzzznet['relu4_1']zzzz=zzzzrelu_layer('relu4_1',zzzznet['conv4_1'],zzzzb=get_bias(vgg_layers,zzzz19))abcdeabcdezzzzzzzzzzzzzzzznet['conv4_2']zzzz=zzzzconv_layer('conv4_2',zzzznet['relu4_1'],zzzzW=get_weights(vgg_layers,zzzz21))abcdezzzzzzzzzzzzzzzznet['relu4_2']zzzz=zzzzrelu_layer('relu4_2',zzzznet['conv4_2'],zzzzb=get_bias(vgg_layers,zzzz21))abcdeabcdezzzzzzzzzzzzzzzznet['conv4_3']zzzz=zzzzconv_layer('conv4_3',zzzznet['relu4_2'],zzzzW=get_weights(vgg_layers,zzzz23))abcdezzzzzzzzzzzzzzzznet['relu4_3']zzzz=zzzzrelu_layer('relu4_3',zzzznet['conv4_3'],zzzzb=get_bias(vgg_layers,zzzz23))abcdeabcdezzzzzzzzzzzzzzzznet['conv4_4']zzzz=zzzzconv_layer('conv4_4',zzzznet['relu4_3'],zzzzW=get_weights(vgg_layers,zzzz25))abcdezzzzzzzzzzzzzzzznet['relu4_4']zzzz=zzzzrelu_layer('relu4_4',zzzznet['conv4_4'],zzzzb=get_bias(vgg_layers,zzzz25))abcdeabcdezzzzzzzzzzzzzzzznet['pool4']zzzzzzzzzzzz=zzzzpool_layer('pool4',zzzznet['relu4_4'])abcdeabcdezzzzzzzzzzzzzzzz#zzzzifzzzzargs.verbose:zzzzprint('LAYERzzzzGROUPzzzz5')abcdezzzzzzzzzzzzzzzznet['conv5_1']zzzz=zzzzconv_layer('conv5_1',zzzznet['pool4'],zzzzW=get_weights(vgg_layers,zzzz28))abcdezzzzzzzzzzzzzzzznet['relu5_1']zzzz=zzzzrelu_layer('relu5_1',zzzznet['conv5_1'],zzzzb=get_bias(vgg_layers,zzzz28))abcdeabcdezzzzzzzzifzzzzlayer_numzzzz==zzzz5:abcdezzzzzzzzzzzzzzzznet['conv5_1']zzzz=zzzzconv_layer('conv5_1',zzzznet['input'],zzzzW=get_weights(vgg_layers,zzzz28))abcdezzzzzzzzzzzzzzzznet['relu5_1']zzzz=zzzzrelu_layer('relu5_1',zzzznet['conv5_1'],zzzzb=get_bias(vgg_layers,zzzz28))abcdeabcdezzzzzzzzzzzzzzzznet['conv5_2']zzzz=zzzzconv_layer('conv5_2',zzzznet['relu5_1'],zzzzW=get_weights(vgg_layers,zzzz30))abcdezzzzzzzzzzzzzzzznet['relu5_2']zzzz=zzzzrelu_layer('relu5_2',zzzznet['conv5_2'],zzzzb=get_bias(vgg_layers,zzzz30))abcdeabcdezzzzzzzzzzzzzzzznet['conv5_3']zzzz=zzzzconv_layer('conv5_3',zzzznet['relu5_2'],zzzzW=get_weights(vgg_layers,zzzz32))abcdezzzzzzzzzzzzzzzznet['relu5_3']zzzz=zzzzrelu_layer('relu5_3',zzzznet['conv5_3'],zzzzb=get_bias(vgg_layers,zzzz32))abcdeabcdezzzzzzzzzzzzzzzznet['conv5_4']zzzz=zzzzconv_layer('conv5_4',zzzznet['relu5_3'],zzzzW=get_weights(vgg_layers,zzzz34))abcdezzzzzzzzzzzzzzzznet['relu5_4']zzzz=zzzzrelu_layer('relu5_4',zzzznet['conv5_4'],zzzzb=get_bias(vgg_layers,zzzz34))abcdeabcdezzzzzzzzzzzzzzzznet['pool5']zzzzzzzzzzzz=zzzzpool_layer('pool5',zzzznet['relu5_4'])abcdeabcdezzzzzzzzreturnzzzznetabcdeabcdeabcdeabcdeabcdedefzzzzcreateImage(tensor):abcdezzzzzzzzzzzzzzzznewImagezzzz=zzzznp.zeros((len(tensor[0]),len(tensor[0][0]),3))abcdezzzzzzzzzzzzzzzzforzzzzzzzzzinzzzzrange(len(tensor[0][0][0])):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(len(tensor[0])):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(len(tensor[0][y])):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImage[y][x][0]zzzz=zzzztensor[0][y][x][z]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImage[y][x][1]zzzz=zzzztensor[0][y][x][z]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImage[y][x][2]zzzz=zzzztensor[0][y][x][z]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImagezzzz=zzzznp.asarray(newImage).astype('float64')abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImagezzzz+=zzzz127.0#MEAN_VALUES[0]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImagezzzz=zzzznewImage[:,zzzz:,zzzz::-1]abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzznewImagezzzz=zzzznp.clip(newImage,zzzz0,zzzz255).astype('uint8')abcdezzzzzzzzzzzzzzzzreturnzzzznewImageabcdeabcdeabcdedefzzzzminimize_with_lbfgs(sess,zzzznet,zzzzoptimizer,zzzzinit_img,zzzzgoal_img):abcdezzzzzzzzinit_opzzzz=zzzztf.global_variables_initializer()abcdezzzzzzzzsess.run(init_op)abcdezzzzzzzzsess.run(net['input'].assign(init_img))abcdezzzzzzzz#zzzzsess.run(net['y_'].assign(goal_img))abcdezzzzzzzzoptimizer.minimize(sess)abcdeabcdedefzzzzminimize_with_adam(sess,zzzznet,zzzzoptimizer,zzzzinit_img,zzzzgoal_img,zzzzloss,zzzzmax_iterations,zzzzcheck_layer,zzzzoutput_layer,zzzzprint_iterations):abcdezzzzzzzztrain_opzzzz=zzzzoptimizer.minimize(loss)abcdezzzzzzzzinit_opzzzz=zzzztf.global_variables_initializer()abcdezzzzzzzzsess.run(init_op)abcdeabcdezzzzzzzziterationszzzz=zzzz0abcdezzzzzzzzwhilezzzz(iterationszzzz<zzzzmax_iterations):abcdezzzzzzzzzzzzzzzzsess.run(train_op)abcdezzzzzzzzzzzzzzzzifzzzziterationszzzz%zzzzprint_iterations==0:abcdezzzzzzzzzzzzzzzzzzzzzzzzcurr_losszzzz=zzzzloss.eval()abcdezzzzzzzzzzzzzzzzzzzzzzzzprint("Atzzzziteratezzzz{}\tf=zzzzzzzz{:.5E}".format(iterations,zzzzcurr_loss))abcdezzzzzzzzzzzzzzzzzzzzzzzz#zzzzcv2.imwrite("./output/"+str(iterations)+"input.jpg",createImage(sess.run(net[output_layer])))abcdezzzzzzzzzzzzzzzzzzzzzzzz#zzzzcv2.imwrite("./output/"+str(iterations)+"relu.jpg",createImage(sess.run(net[check_layer])))abcdeabcdezzzzzzzzzzzzzzzziterationszzzz+=zzzz1abcdeabcdeabcdedefzzzzgetLoss(sess,zzzzvggModel,zzzzlayer,zzzzgenerate_image,zzzzgoal_image):abcdeabcdezzzzzzzzzzzzzzzzsess.run(vggModel['input'].assign(generate_image))abcdeabcdezzzzzzzzzzzzzzzzsubzzzz=zzzztf.subtract(vggModel[layer],vggModel['y_'])abcdezzzzzzzzzzzzzzzzabso=zzzztf.norm(sub)abcdezzzzzzzzzzzzzzzzreturnzzzztf.pow(abso,2)abcdeabcdeabcdedefzzzzget_optimizer(loss,zzzzselect_optimizer,zzzzlearning_rate,zzzzmax_iterations,zzzzprint_iterations):abcdezzzzzzzzifzzzzselect_optimizerzzzz==zzzz'lbfgs':abcdezzzzzzzzzzzzzzzzoptimizerzzzz=zzzztf.contrib.opt.ScipyOptimizerInterface(abcdezzzzzzzzzzzzzzzzzzzzzzzzloss,zzzzmethod='L-BFGS-B',abcdezzzzzzzzzzzzzzzzzzzzzzzzoptions={'maxiter':zzzzmax_iterationsabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz})abcdezzzzzzzzelifzzzzselect_optimizerzzzz==zzzz'adam':abcdezzzzzzzzzzzzzzzzoptimizerzzzz=zzzztf.train.AdamOptimizer(learning_rate)abcdezzzzzzzzreturnzzzzoptimizerabcdeabcdeabcdeabcdedefzzzznewDeconv(sess,zzzzgoal_img,zzzzselect_optimizer,zzzzmax_iterations,zzzzcheck_layer,zzzzoutput_layer,zzzzlayer_num,zzzzchannel):abcdezzzzzzzzzzzzzzzz#zzzzvggModel['y']zzzz=zzzztf.Variable(tf.constant(goal_img))abcdezzzzzzzzzzzzzzzznoisezzzz=zzzzgenerateNoiseImage(int(len(goal_img[0])*2),int(len(goal_img[0][0])*2),channel)abcdezzzzzzzzzzzzzzzznoisezzzz=zzzznp.asarray(noise,dtype=np.float32)abcdezzzzzzzzzzzzzzzznoisezzzz-=zzzz127.0abcdezzzzzzzzzzzzzzzzinit_imgzzzz=zzzznp.asarray([noise],dtype=np.float32)abcdeabcdezzzzzzzzzzzzzzzz#zzzzgoal_imgzzzz-=127.0abcdezzzzzzzzzzzzzzzzgoal_imgzzzz=zzzznp.asarray([goal_img],dtype=np.float32)abcdeabcdeabcdezzzzzzzzzzzzzzzz#zzzznoisezzzz-=zzzz127.0#MEAN_VALUES[0]abcdezzzzzzzzzzzzzzzzvggModelzzzz=zzzzbuild_model(noise,int(len(goal_img[0])/2),int(len(goal_img[0][0])/2),channel,layer_num)abcdezzzzzzzzzzzzzzzzvggModel['y_']zzzz=zzzztf.constant(goal_img)abcdeabcdezzzzzzzzzzzzzzzzL_total=getLoss(sess,zzzzvggModel,zzzzcheck_layer,zzzzinit_img,zzzzgoal_img)abcdezzzzzzzzzzzzzzzz#zzzzL_totalzzzz=zzzzsum_total_variation_losses(sess,zzzzvggModel,zzzzinit_img)abcdezzzzzzzzzzzzzzzzoptimizer=get_optimizer(L_total,select_optimizer,zzzz1e-1,zzzzmax_iterations,1000)abcdezzzzzzzzzzzzzzzzifzzzzselect_optimizerzzzz==zzzz'adam':abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzsess,zzzznet,zzzzoptimizer,zzzzinit_img,zzzzgoal_img,zzzzloss,zzzzmax_iterations,zzzzsess,zzzznet,zzzzoptimizer,zzzzinit_img,zzzzgoal_img,zzzzloss,zzzzmax_iterations,zzzzcheck_layer,zzzzoutput_layer,zzzzprint_iterationsabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimize_with_adam(sess,zzzzvggModel,zzzzoptimizer,zzzzinit_img,zzzzgoal_img,zzzzL_total,max_iterations,check_layer,zzzzoutput_layer,1000)abcdezzzzzzzzzzzzzzzzelifzzzzselect_optimizerzzzz==zzzz'lbfgs':abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzminimize_with_lbfgs(sess,zzzzvggModel,zzzzoptimizer,zzzzinit_img,zzzzgoal_img)abcdeabcdezzzzzzzzzzzzzzzzreturnzzzzsess.run(vggModel[output_layer])abcdezzzzzzzzzzzzzzzz#zzzzoutput_imgzzzz=zzzzsess.run(vggModel[check_layer])abcdezzzzzzzzzzzzzzzz#zzzzin_imgzzzz=zzzzsess.run(vggModel[output_layer])abcdeabcdezzzzzzzzzzzzzzzz#zzzzprint(output_img.shape)abcdezzzzzzzzzzzzzzzz#zzzzoutput_imgzzzz=zzzzcreateImage(output_img)abcdezzzzzzzzzzzzzzzz#zzzzprint(output_img.shape)abcdezzzzzzzzzzzzzzzz#zzzzoutput_imgzzzz=zzzzcreateImage(output_img)#zzzz+zzzzMEAN_VALUESabcdezzzzzzzzzzzzzzzz#zzzzoutput_imgzzzz=zzzznp.clip(output_img,0,255).astype('uint8')abcdezzzzzzzzzzzzzzzz#zzzzcv2.imshow("L4",output_img)abcdezzzzzzzzzzzzzzzz#zzzzcv2.waitKey(0)abcdezzzzzzzzzzzzzzzz#zzzzcv2.imshow("L3_2",createImage(in_img))abcdezzzzzzzzzzzzzzzz#zzzzcv2.waitKey(0)abcdezzzzzzzzzzzzzzzz#zzzzcv2.imshow("input",createImage(sess.run(vggModel['input'])))abcdezzzzzzzzzzzzzzzz#zzzzcv2.waitKey(0)abcdeabcdedefzzzzgenerateNoiseImage(height,zzzzwidth,zzzzchannel):abcdezzzzzzzzzzzzzzzzrandomByteArrayzzzz=zzzzbytearray(os.urandom(height*width*channel))zzzz#画素数文の乱数発生abcdezzzzzzzzzzzzzzzzreturnzzzznp.asarray(randomByteArray).reshape((height,zzzzwidth,zzzzchannel))abcdeabcdedefzzzzgetMono(img):abcdezzzzzzzzzzzzzzzzreturnzzzzcv2.cvtColor(img,zzzzcv2.COLOR_RGB2GRAY)abcdeabcdeabcdedefzzzzupsampling(Phi):abcdezzzzzzzzzzzzzzzztempzzzz=zzzznp.zeros((len(Phi),len(Phi[0]),3))abcdeabcdezzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(len(Phi)):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(len(Phi[y])):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzztemp[y][x]zzzz=zzzz[Phi[y][x][0]*2.0,Phi[y][x][1]*2.0,0]abcdeabcdezzzzzzzzzzzzzzzztempzzzz=zzzzcv2.resize(temp,zzzzNone,zzzzfx=2,zzzzfy=2,zzzzinterpolation=zzzzcv2.INTER_NEAREST)abcdeabcdezzzzzzzzzzzzzzzzretzzzz=zzzznp.zeros((len(temp),len(temp[0]),2))abcdezzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(len(temp)):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(len(temp[y])):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzret[y][x]zzzz=zzzz[temp[y][x][0],temp[y][x][1]]abcdezzzzzzzzzzzzzzzzreturnzzzznp.asarray(ret)abcdeabcdeabcdedefzzzzPhi2Image(Phi):abcdezzzzzzzzzzzzzzzzretzzzz=zzzznp.zeros((len(Phi),len(Phi[0]),3))abcdezzzzzzzzzzzzzzzzforzzzzyzzzzinzzzzrange(len(Phi)):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzforzzzzxzzzzinzzzzrange(len(Phi[y])):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzret[y][x]zzzz=zzzz[Phi[y][x][1],0,Phi[y][x][0]]abcdezzzzzzzzzzzzzzzzretzzzz=zzzznp.clip(ret,0,255)abcdezzzzzzzzzzzzzzzzretzzzz=zzzznp.asarray(ret,dtype='uint8')abcdezzzzzzzzzzzzzzzzreturnzzzzretabcdeabcdeabcdedefzzzzW2tensor(W):abcdezzzzzzzzzzzzzzzzavezzzz=zzzz(W.max()-W.min())abcdezzzzzzzzzzzzzzzzmini=zzzzW.min()abcdezzzzzzzzzzzzzzzzWzzzz-=zzzzminiabcdezzzzzzzzzzzzzzzzWzzzz/=zzzzaveabcdezzzzzzzzzzzzzzzzreturnzzzzWabcdeabcdeifzzzz__name__zzzz==zzzz'__main__':abcdeabcdezzzzzzzzzzzzzzzzsesszzzz=zzzztf.InteractiveSession()abcdezzzzzzzzzzzzzzzztf.global_variables_initializer().run()abcdezzzzzzzzzzzzzzzzmodelzzzz=zzzzload_vgg_model(VGG_MODEL)abcdeabcdezzzzzzzzzzzzzzzzimgAzzzz=zzzzcv2.imread('avater.jpg')abcdezzzzzzzzzzzzzzzzimgzzzz=zzzznp.asarray([imgA]).astype('float64')abcdezzzzzzzzzzzzzzzzimgzzzz-=zzzzMEAN_VALUESabcdezzzzzzzzzzzzzzzz#zzzzimgzzzz=zzzzimg[:,zzzz:,zzzz::-1].astype('float64')abcdeabcdeabcdezzzzzzzzzzzzzzzzsess.run(model['input'].assign(np.asarray(img)))abcdezzzzzzzzzzzzzzzzA=[]abcdezzzzzzzzzzzzzzzzA.append(sess.run(model['conv1_1']))abcdezzzzzzzzzzzzzzzzA.append(sess.run(model['conv2_1']))abcdezzzzzzzzzzzzzzzzA.append(sess.run(model['conv3_1']))abcdezzzzzzzzzzzzzzzzA.append(sess.run(model['conv4_1']))abcdezzzzzzzzzzzzzzzzA.append(sess.run(model['conv5_1']))abcdeabcdeabcdezzzzzzzzzzzzzzzzimgBzzzz=zzzzcv2.imread('monariza.jpg')abcdezzzzzzzzzzzzzzzzimgzzzz=zzzznp.asarray([imgB]).astype('float64')abcdezzzzzzzzzzzzzzzzimgzzzz-=zzzzMEAN_VALUESabcdezzzzzzzzzzzzzzzz#zzzzimgzzzz=zzzzimg[:,zzzz:,zzzz::-1].astype('float64')abcdezzzzzzzzzzzzzzzz#zzzzcv2.imshow("",createImage(img))abcdezzzzzzzzzzzzzzzz#zzzzcv2.waitKey(0)abcdeabcdeabcdezzzzzzzzzzzzzzzzsess.run(model['input'].assign(np.asarray(img)))abcdezzzzzzzzzzzzzzzzB=[]abcdezzzzzzzzzzzzzzzzB.append(sess.run(model['conv1_1']))abcdezzzzzzzzzzzzzzzzB.append(sess.run(model['conv2_1']))abcdezzzzzzzzzzzzzzzzB.append(sess.run(model['conv3_1']))abcdezzzzzzzzzzzzzzzzB.append(sess.run(model['conv4_1']))abcdezzzzzzzzzzzzzzzzB.append(sess.run(model['conv5_1']))abcdeabcdeabcdezzzzzzzzzzzzzzzzazzzz=zzzz[0.8,zzzz0.7,zzzz0.6,zzzz0.1]abcdezzzzzzzzzzzzzzzzchannel=[256,128,64,3]abcdezzzzzzzzzzzzzzzzcheck_layers=['relu5_1','relu4_1','relu3_1','relu2_1','relu1_1']abcdezzzzzzzzzzzzzzzzpatch=[[5,5],[5,5],[5,5],[3,3],[3,3]]abcdezzzzzzzzzzzzzzzzrandomWalkArea=[[4,4],[4,4],[6,6],[6,6],[36,36]]abcdeabcdezzzzzzzzzzzzzzzzPhiABzzzz=zzzzgetPhi_Random(A[5-1])abcdezzzzzzzzzzzzzzzzPhiBAzzzz=zzzzgetPhi_Random(B[5-1])abcdeabcdezzzzzzzzzzzzzzzz######abcdezzzzzzzzzzzzzzzz#zzzzi=0abcdezzzzzzzzzzzzzzzz#zzzzcv2.namedWindow("img",zzzzcv2.WINDOW_NORMAL)abcdezzzzzzzzzzzzzzzz#zzzzPhiABzzzz=zzzzpatchMatch(A[5-1-i],zzzzzzzzA[5-1-i],B[5-1-i],B[5-1-i],zzzzzzzzrandomWalkArea[5-1-i],zzzzpatch[5-1-i],zzzzPhiAB)abcdezzzzzzzzzzzzzzzz#zzzz#zzzzPhiABzzzz=zzzzupsampling(PhiAB)abcdezzzzzzzzzzzzzzzz#zzzz#zzzzPhiABzzzz=zzzzupsampling(PhiAB)abcdezzzzzzzzzzzzzzzz#zzzz#zzzzPhiABzzzz=zzzzupsampling(PhiAB)abcdezzzzzzzzzzzzzzzz#zzzz#zzzzPhiABzzzz=zzzzupsampling(PhiAB)abcdeabcdezzzzzzzzzzzzzzzz#zzzzpiczzzz=zzzzPhi2Image(PhiAB)abcdezzzzzzzzzzzzzzzz#zzzzpiczzzz=zzzznp.asarray(pic*14,zzzzdtype='uint8')abcdezzzzzzzzzzzzzzzz#zzzzcv2.imshow("img",pic)abcdezzzzzzzzzzzzzzzz#zzzzcv2.waitKey(0)abcdezzzzzzzzzzzzzzzz#zzzzcv2.destroyAllWindows()abcdezzzzzzzzzzzzzzzz#zzzzprint(pic)abcdezzzzzzzzzzzzzzzz#######abcdeabcdezzzzzzzzzzzzzzzzFBzzzzzzzzzzzzzzzz=zzzzNoneabcdezzzzzzzzzzzzzzzzFAdash=zzzzNoneabcdezzzzzzzzzzzzzzzzforzzzzizzzzinzzzzrange(5):abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzprint("PhiAB:{0}".format(PhiAB.shape))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzprint("PhiBA:{0}".format(PhiBA.shape))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzi==0:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzstartzzzz=zzzztime.time()abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzPhiABzzzz=zzzzpatchMatchA(A[5-1-i],zzzzA[5-1-i],zzzzB[5-1-i],B[5-1-i],zzzzzzzzrandomWalkArea[5-1-i],zzzzpatch[5-1-i],zzzzPhiAB)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzelapsed_timezzzz=zzzztime.time()zzzz-zzzzstartabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzprintzzzz("2_time:{0}".format(elapsed_time)zzzz+zzzz"[sec]")abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzstartzzzz=zzzztime.time()abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzPhiBAzzzz=zzzzpatchMatchA(B[5-1-i],zzzzB[5-1-i],zzzzA[5-1-i],A[5-1-i],zzzzzzzzrandomWalkArea[5-1-i],zzzzpatch[5-1-i],zzzzPhiBA)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzelapsed_timezzzz=zzzztime.time()zzzz-zzzzstartabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzprintzzzz("2_time:{0}".format(elapsed_time)zzzz+zzzz"[sec]")abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzelse:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzPhiABzzzz=zzzzgetPhi_L_MtoN(A[5-1-i],zzzzFB,zzzzpatch[5-1-i])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzPhiBAzzzz=zzzzgetPhi_L_MtoN(B[5-1-i],zzzzFADash,zzzzpatch[5-1-i])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzstartzzzz=zzzztime.time()abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzPhiABzzzz=zzzzpatchMatchA(A[5-1-i],zzzzFAdash,zzzzFB,zzzzB[5-1-i],zzzzrandomWalkArea[5-1-i],zzzzpatch[5-1-i],zzzzPhiAB)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzelapsed_timezzzz=zzzztime.time()zzzz-zzzzstartabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzprintzzzz("2_time:{0}".format(elapsed_time)zzzz+zzzz"[sec]")abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzstartzzzz=zzzztime.time()abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzPhiBAzzzz=zzzzpatchMatchA(FB,zzzzB[5-1-i],zzzzA[5-1-i],zzzzFAdash,zzzzrandomWalkArea[5-1-i],zzzzpatch[5-1-i],zzzzPhiBA)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzelapsed_timezzzz=zzzztime.time()zzzz-zzzzstartabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzprintzzzz("2_time:{0}".format(elapsed_time)zzzz+zzzz"[sec]")abcdeabcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzifzzzzi<4:abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzBdashzzzz=zzzzwarp(A[5-1-i],PhiBA)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzAdashzzzz=zzzzwarp(B[5-1-i],PhiAB)abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzRAzzzzzzzzzzzzzzzz=zzzznewDeconv(sess,zzzzAdash,zzzz'adam',zzzz2001,zzzzcheck_layers[i],zzzzcheck_layers[i+1],zzzz5-1-i,channel[i])zzzzabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzRBzzzzzzzzzzzzzzzz=zzzznewDeconv(sess,zzzzBdash,zzzz'adam',zzzz2001,zzzzcheck_layers[i],zzzzcheck_layers[i+1],zzzz5-1-i,channel[i])zzzzabcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzWAzzzzzzzzzzzzzzzz=zzzzgetWeight(A[5-2-i],a[i])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzWBzzzzzzzzzzzzzzzz=zzzzgetWeight(B[5-2-i],a[i])abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzWA=W2tensor(WA)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzWB=W2tensor(WB)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz#zzzzprint(WA)abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzprint("RB:{0}".format(RB.shape))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzprint("A:{0}".format(A[5-2-i].shape))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzprint("WA:{0}".format(WA.shape))abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzFAdash=zzzzweightBlend(A[5-2-i],WA,zzzzRB)zzzzabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzFBzzzzzzzzzzzzzzzz=zzzzweightBlend(B[5-2-i],WB,zzzzRA)abcdeabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzPhiABzzzz=zzzzupsampling(PhiAB)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzPhiBAzzzz=zzzzupsampling(PhiBA)abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzcv2.imwrite("A"+str(i)+".jpg",createImage(A[5-1-i]))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzcv2.imwrite("B"+str(i)+".jpg",createImage(B[5-1-i]))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzcv2.imwrite("warpA"+str(i)+".jpg",createImage(Adash))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzcv2.imwrite("warpB"+str(i)+".jpg",createImage(Bdash))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzcv2.imwrite("PhiA"+str(i)+".jpg",Phi2Image(PhiAB))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzcv2.imwrite("PhiB"+str(i)+".jpg",Phi2Image(PhiBA))zzzzabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzcv2.imwrite("RA"+str(i)+".jpg",createImage(RA))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzcv2.imwrite("RB"+str(i)+".jpg",createImage(RB))zzzzabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzcv2.imwrite("WA"+str(i)+".jpg",createImage(WA))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzcv2.imwrite("WB"+str(i)+".jpg",createImage(WB))zzzzabcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzcv2.imwrite("FAdash"+str(i)+".jpg",createImage(FAdash))abcdezzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzcv2.imwrite("FB"+str(i)+".jpg",createImage(FB))zzzzabcdeabcdezzzzzzzzzzzzzzzztempAzzzz=zzzzwarp(np.asarray([imgA]),PhiAB)abcdezzzzzzzzzzzzzzzztempBzzzz=zzzzwarp(np.asarray([imgB]),PhiBA)abcdezzzzzzzzzzzzzzzzA=makeFinImage(tempA)abcdezzzzzzzzzzzzzzzzB=makeFinImage(tempB)abcdezzzzzzzzzzzzzzzzprint(A.shape)abcdezzzzzzzzzzzzzzzzprint(B.shape)abcdezzzzzzzzzzzzzzzzprint(A)abcdezzzzzzzzzzzzzzzzprint(B)abcdezzzzzzzzzzzzzzzz#zzzznp.divide(temp,25.0)abcdezzzzzzzzzzzzzzzz#zzzzAzzzz+=zzzzMEAN_VALUESabcdezzzzzzzzzzzzzzzz#zzzzBzzzz+=zzzzMEAN_VALUESabcdezzzzzzzzzzzzzzzzcv2.imshow("A",np.asarray(A,dtype='uint8'))abcdezzzzzzzzzzzzzzzzcv2.waitKey(0)abcdezzzzzzzzzzzzzzzzcv2.imshow("B",np.asarray(B,dtype='uint8'))abcdezzzzzzzzzzzzzzzzcv2.waitKey(0)abcdeabcdezzzzzzzzzzzzzzzzcv2.imwrite("A.jpg",A)abcdezzzzzzzzzzzzzzzzcv2.imwrite("B.jpg",B)zzzzabcdeabcdezzzzzzzzzzzzzzzzsess.close()
